# Hybrid Trading Mode Implementation

## æ¦‚è¿°

æˆåŠŸå®ç°äº†Dexterçš„æ··åˆäº¤æ˜“æ¨¡å¼ï¼Œå°†æ·±åº¦ç ”ç©¶èƒ½åŠ›ä¸é«˜é¢‘äº¤æ˜“æ‰§è¡Œç›¸ç»“åˆã€‚

## ğŸ¯ æ ¸å¿ƒåˆ›æ–°

### é—®é¢˜
åŸç³»ç»Ÿåªé€‚åˆä½é¢‘ç ”ç©¶ï¼ˆ8-50ç§’å»¶è¿Ÿï¼‰ï¼Œæ— æ³•æ”¯æŒé«˜é¢‘äº¤æ˜“ï¼ˆéœ€è¦<10msï¼‰ã€‚

### è§£å†³æ–¹æ¡ˆ
**åˆ†å±‚æ¶æ„**ï¼šAIæ·±åº¦æ€è€ƒç”Ÿæˆç­–ç•¥ï¼ˆæ…¢ï¼‰ï¼Œé¢„ç¼–è¯‘ç­–ç•¥å¿«é€Ÿæ‰§è¡Œï¼ˆå¿«ï¼‰ã€‚

```
Research Mode (Strategic Layer)     Trading Mode (Tactical Layer)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ è¿è¡Œé¢‘ç‡: å®šæœŸï¼ˆå¦‚æ¯å°æ—¶ï¼‰          â€¢ è¿è¡Œé¢‘ç‡: å®æ—¶ï¼ˆæ¯«ç§’çº§ï¼‰
â€¢ å»¶è¿Ÿ: 8-50ç§’                      â€¢ å»¶è¿Ÿ: < 1æ¯«ç§’
â€¢ ä½¿ç”¨: å®Œæ•´Multi-Agentæµç¨‹          â€¢ ä½¿ç”¨: é¢„ç¼–è¯‘è§„åˆ™ï¼ˆæ— LLMï¼‰
â€¢ è¾“å‡º: å¯æ‰§è¡Œç­–ç•¥                   â€¢ è¾“å‡º: äº¤æ˜“å†³ç­–
â€¢ é€‚ç”¨: ç­–ç•¥å¼€å‘ã€æ·±åº¦åˆ†æ            â€¢ é€‚ç”¨: å®æ—¶äº¤æ˜“ã€æ—¥å†…äº¤æ˜“
```

## ğŸ“ æ–°å¢æ–‡ä»¶ç»“æ„

```
src/trading/
â”œâ”€â”€ types.ts                    # ç±»å‹å®šä¹‰ï¼ˆç­–ç•¥ã€å¸‚åœºæ•°æ®ã€å†³ç­–ç­‰ï¼‰
â”œâ”€â”€ schemas.ts                  # Zod schemasï¼ˆç­–ç•¥ç¼–è¯‘ï¼‰
â”œâ”€â”€ prompts.ts                  # LLM promptsï¼ˆç­–ç•¥ç¼–è¯‘ï¼‰
â”œâ”€â”€ strategy-compiler.ts        # å°†AIåˆ†æç¼–è¯‘ä¸ºå¯æ‰§è¡Œç­–ç•¥
â”œâ”€â”€ indicators.ts               # æŠ€æœ¯æŒ‡æ ‡è®¡ç®—å™¨ï¼ˆå¢é‡ç®—æ³•ï¼‰
â”œâ”€â”€ fast-engine.ts              # é«˜é¢‘äº¤æ˜“æ‰§è¡Œå¼•æ“
â”œâ”€â”€ hybrid-orchestrator.ts      # åè°ƒResearchå’ŒTradingæ¨¡å¼
â””â”€â”€ index.ts                    # å¯¼å‡ºæ¥å£

src/agent/
â””â”€â”€ orchestrator.ts             # âœ¨ æ‰©å±•ï¼šæ–°å¢ compileStrategy() æ–¹æ³•

examples/
â”œâ”€â”€ hybrid-trading-demo.ts      # å®Œæ•´æ¼”ç¤º
â””â”€â”€ simple-strategy-example.ts  # ç®€å•ç¤ºä¾‹
```

## ğŸ”§ å®ç°çš„ç»„ä»¶

### 1. StrategyCompiler
- **åŠŸèƒ½**: å°†æ·±åº¦åˆ†æç»“æœç¼–è¯‘ä¸ºå¯æ‰§è¡Œç­–ç•¥
- **è¾“å…¥**: Understanding + Plans + TaskResults
- **è¾“å‡º**: CompiledStrategyï¼ˆåŒ…å«å¯æ‰§è¡Œå‡½æ•°ï¼‰
- **å…³é”®ç‰¹æ€§**:
  - å°†æ¡ä»¶å­—ç¬¦ä¸²ç¼–è¯‘ä¸ºJavaScriptå‡½æ•°
  - ç­–ç•¥éªŒè¯å’Œåºåˆ—åŒ–
  - è‡ªåŠ¨è¿‡æœŸæ—¶é—´è®¡ç®—

### 2. IndicatorCalculator  
- **åŠŸèƒ½**: è®¡ç®—æŠ€æœ¯æŒ‡æ ‡ï¼ˆRSI, MACD, SMA, EMA, BBç­‰ï¼‰
- **ä¼˜åŒ–**: å¢é‡ç®—æ³•ï¼ŒO(1)æ›´æ–°å¤æ‚åº¦
- **ç¼“å­˜**: æ™ºèƒ½ç¼“å­˜ä¸­é—´ç»“æœ
- **æ”¯æŒæŒ‡æ ‡**:
  - è¶‹åŠ¿: SMA, EMA (å¤šå‘¨æœŸ)
  - åŠ¨é‡: RSI, MACD
  - æ³¢åŠ¨: Bollinger Bands, ATR
  - æˆäº¤é‡: Volume Average, Volume Ratio

### 3. FastTradingEngine
- **åŠŸèƒ½**: å®æ—¶æ‰§è¡Œç­–ç•¥ï¼ˆæ— LLMè°ƒç”¨ï¼‰
- **ç›®æ ‡å»¶è¿Ÿ**: < 1ms
- **ç‰¹æ€§**:
  - ç­–ç•¥åŠ è½½å’Œç®¡ç†
  - å®æ—¶å†³ç­–ç”Ÿæˆ
  - é£é™©ç®¡ç†ï¼ˆæ­¢æŸã€ä»“ä½æ§åˆ¶ï¼‰
  - æ€§èƒ½æŒ‡æ ‡è·Ÿè¸ª
  - æ¨¡æ‹Ÿäº¤æ˜“æ‰§è¡Œ

### 4. HybridOrchestrator
- **åŠŸèƒ½**: åè°ƒä¸¤ç§æ¨¡å¼
- **èŒè´£**:
  - åå°å®šæœŸåˆ·æ–°ç­–ç•¥ï¼ˆResearch Modeï¼‰
  - å®æ—¶å¤„ç†å¸‚åœºæ•°æ®ï¼ˆTrading Modeï¼‰
  - Watchlistç®¡ç†
  - ç­–ç•¥ç¼“å­˜å’ŒåŠ è½½
  - æ€§èƒ½ç›‘æ§

### 5. Agent Extension
- **æ–°å¢æ–¹æ³•**: `compileStrategy(query, messageHistory)`
- **åŠŸèƒ½**: è¿è¡Œå®Œæ•´ç ”ç©¶æµç¨‹ä½†è¾“å‡ºç­–ç•¥è€Œéæ–‡æœ¬
- **ä¿æŒ**: æ‰€æœ‰åŸæœ‰åŠŸèƒ½ä¸å˜

## ğŸ’¡ ä½¿ç”¨æ–¹å¼

### æ–¹å¼1: çº¯ç ”ç©¶æ¨¡å¼ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰
```typescript
const agent = new Agent({ model: 'gpt-4o' });
const answer = await agent.run("Analyze Apple's financials");
```

### æ–¹å¼2: ç­–ç•¥ç¼–è¯‘
```typescript
const agent = new Agent({ model: 'gpt-4o' });
const strategy = await agent.compileStrategy("Create trading strategy for AAPL");
```

### æ–¹å¼3: æ··åˆæ¨¡å¼ï¼ˆæ¨èï¼‰
```typescript
const orchestrator = new HybridOrchestrator({
  watchlist: ['AAPL', 'MSFT'],
  strategyRefreshIntervalMs: 3600000, // 1å°æ—¶
});

await orchestrator.start(); // è‡ªåŠ¨åå°åˆ·æ–°ç­–ç•¥

// å®æ—¶äº¤æ˜“
marketDataStream.on('data', async (data) => {
  const decision = await orchestrator.onMarketData(data.ticker, data);
  if (decision) {
    await orchestrator.executeTrade(decision);
  }
});
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | Research Mode | Trading Mode |
|------|---------------|--------------|
| å»¶è¿Ÿ | 8-50ç§’ | < 1ms |
| LLMè°ƒç”¨ | 5-20æ¬¡ | 0æ¬¡ |
| é€‚ç”¨é¢‘ç‡ | ä½é¢‘ï¼ˆå°æ—¶/å¤©ï¼‰ | é«˜é¢‘ï¼ˆæ¯«ç§’ï¼‰ |
| CPUä½¿ç”¨ | ä¸­ç­‰ï¼ˆLLMç­‰å¾…ï¼‰ | æä½ï¼ˆçº¯è®¡ç®—ï¼‰ |
| å¤æ‚åº¦ | é«˜ï¼ˆæ·±åº¦åˆ†æï¼‰ | ä½ï¼ˆè§„åˆ™æ‰§è¡Œï¼‰ |

## ğŸ¨ é¢è¯•äº®ç‚¹

### æŠ€æœ¯äº®ç‚¹
1. **æ··åˆæ¶æ„**: ç»“åˆAIæ™ºèƒ½ä¸HFTé€Ÿåº¦
2. **ç­–ç•¥ç¼–è¯‘**: å°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸ºå¯æ‰§è¡Œä»£ç 
3. **å¢é‡ç®—æ³•**: O(1)æŒ‡æ ‡æ›´æ–°å¤æ‚åº¦
4. **åˆ†å±‚è®¾è®¡**: Strategic vs Tacticalå±‚æ¸…æ™°åˆ†ç¦»
5. **å®æ—¶æ€§èƒ½**: Sub-millisecondå†³ç­–å»¶è¿Ÿ

### ç®€å†æè¿°å»ºè®®

```markdown
Financial Deep Research Agent with Hybrid Trading
- è®¾è®¡å¹¶å®ç°æ··åˆæ¶æ„AIé‡‘èç³»ç»Ÿï¼Œç»“åˆæ·±åº¦åˆ†æä¸é«˜é¢‘äº¤æ˜“èƒ½åŠ›
- å¼€å‘ç­–ç•¥ç¼–è¯‘å™¨ï¼Œå°†AIåˆ†æç»“æœè½¬æ¢ä¸ºå¯æ‰§è¡Œäº¤æ˜“è§„åˆ™ï¼ˆ<1mså»¶è¿Ÿï¼‰
- å®ç°å¢é‡æŠ€æœ¯æŒ‡æ ‡è®¡ç®—å™¨ï¼Œä½¿ç”¨O(1)ç®—æ³•æ”¯æŒå®æ—¶å¸‚åœºæ•°æ®å¤„ç†
- æ„å»ºåŒæ¨¡å¼orchestratorï¼šåå°AIç­–ç•¥ä¼˜åŒ– + å‰å°é«˜é¢‘æ‰§è¡Œ
- Tech Stack: TypeScript, LangChain, OpenAI API, Custom Trading Engine
- æ€§èƒ½ï¼šResearchæ¨¡å¼10-50sæ·±åº¦åˆ†æï¼ŒTradingæ¨¡å¼<1mså®æ—¶å†³ç­–
```

## ğŸš€ æ¼”ç¤ºæµç¨‹

### Demo 1: ç­–ç•¥ç¼–è¯‘
```bash
bun run examples/simple-strategy-example.ts
```
å±•ç¤ºï¼šAIå¦‚ä½•ä»æŸ¥è¯¢ç”Ÿæˆå¯æ‰§è¡Œç­–ç•¥

### Demo 2: å®Œæ•´æ··åˆæ¨¡å¼
```bash
bun run examples/hybrid-trading-demo.ts
```
å±•ç¤ºï¼š
- ç­–ç•¥ç¼–è¯‘è¿‡ç¨‹
- å®æ—¶å¸‚åœºæ•°æ®å¤„ç†
- äº¤æ˜“å†³ç­–ç”Ÿæˆ
- æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡

### Demo 3: åŸæœ‰ç ”ç©¶åŠŸèƒ½
```bash
bun start
```
å±•ç¤ºï¼šåŸæœ‰æ·±åº¦ç ”ç©¶åŠŸèƒ½ä»å®Œæ•´ä¿ç•™

## ğŸ“ ä»£ç è´¨é‡

- âœ… æ‰€æœ‰æ–‡ä»¶é€šè¿‡TypeScriptç±»å‹æ£€æŸ¥
- âœ… æ— linteré”™è¯¯
- âœ… å®Œæ•´çš„ç±»å‹å®šä¹‰
- âœ… è¯¦ç»†çš„æ–‡æ¡£æ³¨é‡Š
- âœ… æ¸…æ™°çš„ä»£ç ç»“æ„
- âœ… å‘åå…¼å®¹ï¼ˆæ‰€æœ‰åŸæœ‰åŠŸèƒ½ä¿ç•™ï¼‰

## ğŸ”„ ä¸‹ä¸€æ­¥ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

1. **APIæ›¿æ¢**: å°†Financial Datasets APIæ›¿æ¢ä¸ºå…è´¹APIï¼ˆAlpha Vantageç­‰ï¼‰
2. **å›æµ‹ç³»ç»Ÿ**: æ·»åŠ ç­–ç•¥å›æµ‹åŠŸèƒ½
3. **æŒä¹…åŒ–**: ç­–ç•¥ä¿å­˜åˆ°æ•°æ®åº“
4. **WebSocket**: å®æ—¶å¸‚åœºæ•°æ®æµ
5. **å‰ç«¯ç•Œé¢**: å¯è§†åŒ–ç­–ç•¥å’Œäº¤æ˜“
6. **æ›´å¤šæŒ‡æ ‡**: æ·»åŠ æ›´å¤šæŠ€æœ¯æŒ‡æ ‡
7. **æœºå™¨å­¦ä¹ **: é›†æˆMLæ¨¡å‹ä¼˜åŒ–å‚æ•°

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - é¡¹ç›®ä¸»æ–‡æ¡£ï¼ˆå·²æ›´æ–°ï¼‰
- [examples/hybrid-trading-demo.ts](./examples/hybrid-trading-demo.ts) - å®Œæ•´æ¼”ç¤º
- [examples/simple-strategy-example.ts](./examples/simple-strategy-example.ts) - ç®€å•ç¤ºä¾‹
- [src/trading/](./src/trading/) - æºä»£ç 

---

**å®ç°æ—¶é—´**: çº¦2å°æ—¶
**ä»£ç è¡Œæ•°**: ~2000è¡Œï¼ˆæ–°å¢ï¼‰
**æ–‡ä»¶æ•°é‡**: 11ä¸ªæ–°æ–‡ä»¶
**åŸæœ‰ä»£ç æ”¹åŠ¨**: æœ€å°åŒ–ï¼ˆåªæ‰©å±•ï¼Œä¸ç ´åï¼‰




